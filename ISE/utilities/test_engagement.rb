#!/usr/bin/env ruby
#######################################################################
###
##	File:	test_engagement.rb
##

require 'pathname_mods'
require 'string_mods'
require 'Radar'

require 'aadse_utilities'


traj_file_pathname = Pathname.new("#{ENV['TRAJ_DIR']}/RACM_013.traj")


battery_lla = Array.new
battery_sensor = Array.new

##########################################################################################################################################
battery_lla    << LlaCoordinate.new(25.432, 56.2594, 0.0)
battery_sensor << StaringRadar.new( "lower_tier_5", battery_lla.last, [0.0, 100000.0], [55.0, 30.0], [30.0, 30.0] )
##########################################################################################################################################
##########################################################################################################################################
battery_lla    << LlaCoordinate.new(25.11225, 56.323964, 0.0)
battery_sensor << StaringRadar.new( "lower_tier_6", battery_lla.last, [0.0, 100000.0], [90.0, 30.0], [30.0, 30.0] )
##########################################################################################################################################
##########################################################################################################################################
battery_lla    << LlaCoordinate.new(24.025, 53.728, 0.0)
battery_sensor << StaringRadar.new( "lower_tier_7", battery_lla.last, [0.0, 100000.0], [20.0, 30.0], [30.0, 30.0] )
##########################################################################################################################################
##########################################################################################################################################
battery_lla    << LlaCoordinate.new(24.0156, 53.1959, 0.0)
battery_sensor << StaringRadar.new( "lower_tier_8", battery_lla.last, [0.0, 100000.0], [0.0, 30.0], [30.0, 30.0] )
##########################################################################################################################################
##########################################################################################################################################
battery_lla    << LlaCoordinate.new(23.516, 52.6123, 0.0)
battery_sensor << StaringRadar.new( "lower_tier_9", battery_lla.last, [0.0, 100000.0], [0.0, 30.0], [30.0, 30.0] )
##########################################################################################################################################
##########################################################################################################################################
battery_lla    << LlaCoordinate.new(24.75176, 55.333006, 0.0)
battery_sensor << StaringRadar.new( "upper_tier_1", battery_lla.last, [255000.0, 655000.0], [60.0, 30.0], [5.7, 3.0] )
##########################################################################################################################################
##########################################################################################################################################
battery_lla    << LlaCoordinate.new(25.35, 55.43, 0.0)
battery_sensor << StaringRadar.new( "lower_tier_1", battery_lla.last, [0.0, 100000.0], [30.0, 30.0], [30.0, 30.0] )
##########################################################################################################################################
##########################################################################################################################################
battery_lla    << LlaCoordinate.new(23.401546, 54.631572, 0.0)
battery_sensor << StaringRadar.new( "upper_tier_2", battery_lla.last, [255000.0, 655000.0], [20.0, 30.0], [5.7, 3.0] )
##########################################################################################################################################
##########################################################################################################################################
battery_lla    << LlaCoordinate.new(24.8568, 55.329, 0.0)
battery_sensor << StaringRadar.new( "lower_tier_2", battery_lla.last, [0.0, 100000.0], [340.0, 30.0], [30.0, 30.0] )
##########################################################################################################################################
##########################################################################################################################################
battery_lla    << LlaCoordinate.new(23.41958, 52.601753, 0.0)
battery_sensor << StaringRadar.new( "upper_tier_3", battery_lla.last, [255000.0, 655000.0], [0.0, 30.0], [5.7, 3.0] )
##########################################################################################################################################
##########################################################################################################################################
battery_lla    << LlaCoordinate.new(24.428333, 54.458083, 0.0)
battery_sensor << StaringRadar.new( "lower_tier_3", battery_lla.last, [0.0, 100000.0], [30.0, 30.0], [30.0, 30.0] )
##########################################################################################################################################
##########################################################################################################################################
battery_lla    << LlaCoordinate.new(23.4872, 54.6238, 0.0)
battery_sensor << StaringRadar.new( "lower_tier_4", battery_lla.last, [0.0, 100000.0], [5.0, 30.0], [30.0, 30.0] )
##########################################################################################################################################

battery_sensor.each do |bs|
  puts "-"*15
  puts bs
end

trajectory_array = Array.new


#$verbose = true
#$debug = true

traj_file_pathname.each_line do |a_line|
  al = a_line.chomp.strip.gsub(' ','').downcase
  next if al.empty? or '#' == al[0,1]
  tmp_array = al.split(',')
  traj_lat = tmp_array[1].to_f
  traj_lng = tmp_array[2].to_f
  traj_alt = tmp_array[3].to_f

  trajectory_array << LlaCoordinate.new( traj_lat, traj_lng, traj_alt)

end


num_of_batteries = battery_lla.size - 1


(0..num_of_batteries).each do |index|

  puts "Battery under test: #{battery_sensor[index].name} ..."

  t = 0

  trajectory_array.each do |lla|

    puts "time: #{t} ..."
    if battery_sensor[index].can_detect?(lla)
      puts "Detected! by #{battery_sensor[index].name} at #{lla.lat}, #{lla.lng}"
    end

    t += 1

  end

end






